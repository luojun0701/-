"use strict";var e=require("../../common/vendor.js"),o=require("../../common/upload.js"),l=require("../../utils/index.js"),a=require("../../common/db.js");if(!Array){(e.resolveComponent("cu-input")+e.resolveComponent("cu-modal")+e.resolveComponent("cu-upload")+e.resolveComponent("cu-empty")+e.resolveComponent("cu-loading")+e.resolveComponent("unicloud-db")+e.resolveComponent("cu-cell")+e.resolveComponent("cu-button"))()}Math||((()=>"../../components/cu-input/cu-input.js")+(()=>"../../components/cu-modal/cu-modal.js")+(()=>"../../components/cu-upload/cu-upload.js")+(()=>"../../components/cu-empty/cu-empty.js")+(()=>"../../components/cu-loading/cu-loading.js")+(()=>"../../node-modules/@dcloudio/uni-components/lib/unicloud-db/unicloud-db.js")+(()=>"../../components/cu-cell/cu-cell.js")+(()=>"../../components/cu-button/cu-button.js"))();const t={__name:"publish",setup(t){const n=e.ref(null),u={marginTop:"100rpx"},c=e.ref(!1),i=e.ref(null),r=e.ref(""),s=e.ref(""),d=e.ref("");var v="";const p=e.ref(!1);e.onShow((()=>{d.value=e.index.getStorageSync("html")||""}));const m=()=>{c.value=!1},g=()=>{c.value=!1},h=e=>{let o=e.detail.value;p.value=o},f=()=>{e.index.navigateTo({url:"/pages/editorPage/editorPage"})},j=()=>{""==s.value&&p.value?c.value?e.index.showToast({title:"请填写文章标题",icon:"none"}):c.value=!0:b()},b=l.throttle((async()=>{var l;let t=null;if(p.value){if(""==d.value)return void e.index.showToast({title:"内容不能为空",icon:"none"});let l=/(\/|http)[^>]+\.(jpg|jpeg|png|gif)/g,a=d.value.match(l),n=await o.upload(a),u=0;t=d.value.replace(/(\/|http)[^>]+\.(jpg|jpeg|png|gif)/g,(function(){return++u,n[u-1]})),console.log(t)}else if(""==r.value)return void e.index.showToast({title:"内容不能为空",icon:"none"});let u=await(null==(l=n.value)?void 0:l.upload());e.index.showLoading({title:"发布中..."}),a.addDb("articles",{content:p.value?t:r.value,img_list:u,user_id:getApp().globalData.userinfo._id,title:s.value,mode:p.value?2:1,category_id:v}).then((({result:o})=>{let{errCode:l}=o;e.index.showToast({title:0==l?"发布成功":"发布失败,请重试",icon:"none"}),0==l&&(e.index.removeStorageSync("html"),e.index.navigateBack())}))}));return(o,l)=>e.e({a:p.value},p.value?e.e({b:d.value},d.value?{c:d.value,d:e.o(f)}:{e:e.o(f)},{f:e.o((e=>s.value=e)),g:e.p({placeholder:"请输入文章标题",value:s.value}),h:e.o(g),i:e.o(j),j:e.o(m),k:e.p({show:c.value,title:"填写标题"})}):{l:r.value,m:e.o((e=>r.value=e.detail.value))},{n:e.sr(n,"ca1e2ac8-2",{k:"upload"}),o:e.w((({data:o,loading:l,error:a,options:t,hasMore:n},u,c)=>e.e({a:a},a?{b:"ca1e2ac8-4-"+c+",ca1e2ac8-3",c:e.p({mode:"fail"})}:l?{e:"ca1e2ac8-5-"+c+",ca1e2ac8-3"}:{},{d:l,f:e.f(o,((o,l,a)=>({a:e.t(o.name),b:i.value==l?1:"",c:e.o((e=>((e,o)=>{i.value==e?(v="",i.value=null):(v=o,i.value=e)})(l,o._id)))}))),g:c,h:u})),{name:"d",path:"o",vueId:"ca1e2ac8-3"}),p:e.p({collection:"articles-categories"}),q:p.value,r:e.o(h),s:e.p({title:p.value?"富文本内容":"普通内容"}),t:e.o(j),v:e.p({text:"一键发布",customStyle:u})})}};wx.createPage(t);
