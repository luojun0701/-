"use strict";var e=require("../../common/vendor.js"),o=require("../../utils/index.js");if(!Array){(e.resolveComponent("cu-ps-card")+e.resolveComponent("cu-title")+e.resolveComponent("cu-empty")+e.resolveComponent("cu-loading")+e.resolveComponent("cu-image")+e.resolveComponent("unicloud-db")+e.resolveComponent("cu-msg-input"))()}Math||((()=>"../../components/cu-ps-card/cu-ps-card.js")+(()=>"../../components/cu-title/cu-title.js")+(()=>"../../components/cu-empty/cu-empty.js")+(()=>"../../components/cu-loading/cu-loading.js")+(()=>"../../components/cu-image/cu-image.js")+(()=>"../../node-modules/@dcloudio/uni-components/lib/unicloud-db/unicloud-db.js")+(()=>"../../components/cu-msg-input/cu-msg-input.js"))();const t={__name:"ps-detail",setup(t){const n=e.ref(null),a=e.reactive({pageSize:20,page:1});e.ref({});const c=e.ref(null),l=e.ref(""),u=()=>{var o;""!=l.value?null==(o=c.value)||o.add({article_id:n.value._id,user_id:getApp().globalData.userinfo._id,comment_content:l.value},{toastTitle:"评论成功",success(){e.nextTick((()=>{l.value=""}))}}):e.index.showToast({title:"内容不能为空",icon:"none"})};return e.onLoad((e=>{let o=JSON.parse(decodeURIComponent(e.data));n.value=o})),e.onPullDownRefresh((()=>{c.value.loadData({clear:!0},(()=>{e.index.stopPullDownRefresh()}))})),(t,i)=>{var r;return{a:e.p({data:n.value,detail:!1}),b:e.p({title:"全部评论"}),c:e.w((({data:t,loading:n,error:a,options:c},l,u)=>e.e({a:a},a?{b:"3c79a9b4-3-"+u+",3c79a9b4-2",c:e.p({mode:"fail"})}:n?{e:"3c79a9b4-4-"+u+",3c79a9b4-2"}:0!=t.length?{g:e.f(t,((t,n,a)=>({a:"3c79a9b4-5-"+u+"-"+a+",3c79a9b4-2",b:e.p({src:t.user_id[0].avatarUrl,width:"80rpx",height:"80rpx",radius:"50%"}),c:e.t(t.user_id[0].nickName),d:e.t(t.comment_content),e:e.t(e.unref(o.formatTime)(t.comment_date))})))}:{h:"3c79a9b4-6-"+u+",3c79a9b4-2"},{d:n,f:0!=t.length,i:u,j:l})),{name:"d",path:"c",vueId:"3c79a9b4-2"}),d:e.sr(c,"3c79a9b4-2",{k:"udb"}),e:e.p({collection:"comments,users",where:`article_id=='${null==(r=n.value)?void 0:r._id}'`,field:"comment_content,child_comments,comment_date,user_id{_id,nickName,avatarUrl,role}","page-current":a.page,"page-size":a.pageSize,getcount:!0}),f:e.o(u),g:e.o((e=>l.value=e)),h:e.p({placeholder:"友善评论,文明发言",comment:l.value,value:l.value})}}}};wx.createPage(t);
