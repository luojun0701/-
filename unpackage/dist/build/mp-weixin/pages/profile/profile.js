"use strict";var e=require("../../common/vendor.js"),a=require("../../common/upload.js"),t=require("../../common/db.js");if(!Array){(e.resolveComponent("cu-image")+e.resolveComponent("cu-icon")+e.resolveComponent("cu-input")+e.resolveComponent("cu-button"))()}Math||((()=>"../../components/cu-image/cu-image.js")+(()=>"../../components/cu-icon/cu-icon.js")+(()=>"../../components/cu-input/cu-input.js")+(()=>"../../components/cu-button/cu-button.js"))();const o={__name:"profile",setup(o){const n=getApp(),r=e.ref(null);e.onMounted((()=>{r.value=e.index.getStorageSync("userinfo")}));const i=async()=>{let o={nickName:r.value.nickName,avatarUrl:r.value.avatarUrl};/(http):\/\/([\w.]+\/?)\S*/.test(o.avatarUrl)&&(o.avatarUrl=await a.upload(o.avatarUrl)),o.avatarUrl=o.avatarUrl[0],console.log(o.avatarUrl),""!=o.nickName?t.updateDb("users",`_id=='${r.value._id}'`,o).then((({result:a})=>{let{errCode:t,errMsg:r}=a;if(e.index.showToast({title:0==t?"修改成功":r,icon:"none"}),0==t){let a=n.globalData.userinfo;a.avatarUrl=o.avatarUrl,a.nickName=o.nickName,n.globalData.userinfo=a,e.index.setStorageSync("userinfo",a),setTimeout((()=>{e.index.navigateBack()}),1200)}})):e.index.showToast({title:"昵称不能为空",icon:"none"})},c=()=>{e.index.chooseMedia({count:1,mediaType:["image"],success:e=>{r.value.avatarUrl=e.tempFiles[0].tempFilePath}})};return(a,t)=>{var o;return{a:e.p({width:"180rpx",height:"180rpx",radius:"50%",src:null==(o=r.value)?void 0:o.avatarUrl}),b:e.p({name:"camera",size:"20px",color:"#fff"}),c:e.o(c),d:e.o((e=>r.value.nickName=e)),e:e.p({placeholder:"",border:"bottom",value:r.value.nickName}),f:e.o(i),g:e.p({text:"保存"})}}}};wx.createPage(o);
